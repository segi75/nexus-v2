// [변경 1] 플러그인 버전도 TOML에서 가져옵니다. (alias 사용)
plugins {
    alias(libs.plugins.spring.boot) apply false
    alias(libs.plugins.dependency.management) apply false
    // Kotlin 사용 시 필요한 경우
    // alias(libs.plugins.jvm) apply false 
}

allprojects {
    group = 'com.nexus'
    version = '2.5.0-SNAPSHOT'

    // [중요] 모든 프로젝트가 라이브러리를 받아올 저장소
    repositories {
        mavenCentral()
    }
}

subprojects {

    // nexus-bom은 의존성을 통제하는 곳이지, 자바 코드가 있는 곳이 아니므로 제외
    if (it.name == 'nexus-bom') {
        return
    }

    // [변경 2] 플러그인 적용 (ID는 그대로 사용)
    apply plugin: 'java-library'
    apply plugin: 'io.spring.dependency-management'
    
    // [변경 3] Java 25 공통 설정 (Phase 2.5 핵심)
    java {
        sourceCompatibility = '25'
        targetCompatibility = '25'
    }

    dependencies {
        // 1. 공통 버전 통제 (BOM)
        implementation platform(project(':nexus-bom'))
        annotationProcessor platform(project(':nexus-bom'))
        
        // 2. 테스트 도구 공통 적용 (TOML 변수 사용)
        // [변경] 'org...:spring-boot-starter-test' -> libs.spring.boot.starter.test
        testImplementation libs.spring.boot.starter.test
    }
    
    // [변경 4] 컴파일 옵션 강화
    tasks.withType(JavaCompile) {
        options.encoding = 'UTF-8'
        // Spring Boot/MyBatis에서 파라미터 이름을 인식하기 위해 필수
        options.compilerArgs << '-parameters' 
    }
}