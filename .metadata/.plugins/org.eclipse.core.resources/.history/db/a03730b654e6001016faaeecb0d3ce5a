server:
  port: 8080 # 웹 서버 포트

spring:
  # [긴급 조치] 빈 이름 충돌 허용
  main:
    allow-bean-definition-overriding: true

  application:
    name: nexus-sample-app
  
  # [1] Datasource 설정
  datasource:
    driver-class-name: org.h2.Driver
    url: jdbc:h2:mem:nexus;DB_CLOSE_DELAY=-1;MODE=MSSQLServer
    username: sa
    password:

  # [2] H2 Console 설정
  h2:
    console:
      enabled: true
      path: /h2-console

  # [3] JPA 설정 (Flyway 사용 시 validate 권장)
  jpa:
    hibernate:
      ddl-auto: validate 

# =================================================================
# [4] NEXUS Framework 전용 설정
# =================================================================
nexus:
  # 4-1. DB 마이그레이션 (Flyway)
  migration:
    enabled: true

  # 4-2. 보안 설정 (Security)
  security:
    enabled: true
    use-form-login: false
    public-urls:
      - "/api/public/**"
      - "/health-check"
      - "/actuator/**"    # [중요] 메트릭 수집을 위해 Actuator 경로 허용

  # ▼▼▼ [4-3. 신규 추가] 관찰성 모듈 (Observability) 설정 ▼▼▼
  obs:
    enabled: true         # 모듈 전체 활성화
    tracing-enabled: true # Trace ID (요청 추적) 활성화
    metrics-enabled: true # AOP 기반 성능 측정 활성화

# =================================================================
# [5] MyBatis 설정
# =================================================================
mybatis:
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.nexus.sample
  configuration:
    map-underscore-to-camel-case: true
    jdbc-type-for-null: NULL

# =================================================================
# [6] 로깅 설정 (Logging) - Trace ID 적용
# =================================================================
logging:
  level:
    root: INFO
    com.nexus: DEBUG            # 프레임워크 로그 확인용
    com.nexus.sample: DEBUG
  pattern:
    # [수정됨] %-5level 뒤에 [%X{traceId:-}] 를 추가하여 ID가 출력되도록 함
    console: "%d{yyyy-MM-dd'T'HH:mm:ss.SSSXXX} %-5level [%X{traceId:-}] %pid [%thread] %logger{36} : %msg%n"

# =================================================================
# [7] Actuator 및 Prometheus 설정 (신규 추가)
# =================================================================
management:
  endpoints:
    web:
      exposure:
        include: "health,info,prometheus" # prometheus 엔드포인트 노출
  metrics:
    tags:
      application: ${spring.application.name} # 메트릭에 앱 이름 태그 자동 추가